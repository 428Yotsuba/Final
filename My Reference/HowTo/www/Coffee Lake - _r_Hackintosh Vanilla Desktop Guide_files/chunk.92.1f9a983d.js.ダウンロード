(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[92,160],{104:function(e,t,n){"use strict";n(249);var r=n(43),o=n.n(r);n(10);function a(e){return`users/${e}`}function s(e){return`orgs/${e}`}function i(e){return`spaces/${e}`}function c(e){return`documents/${e}`}function u(e){return`assets/${e}`}var l={userPrefix:a,userUpload:function(e){let t=e.userID,n=e.filename;return`${a(t)}/uploads/${n}`},userExport:function(e){let t=e.userID,n=e.filename;return`${a(t)}/exports/${n}`},document:function(e){let t=e.spaceID,n=e.revisionID,r=e.versionID,o=e.pageID;const a=encodeURIComponent(r);return`${c(t)}/${n}/${a}/${o}/document.json`},documents:c,assets:u,asset:function(e){let t=e.spaceID,n=e.revisionID,r=e.assetID,o=e.fileName;return`${u(t)}/${n}/${r}/${o}`},orgPrefix:s,orgUpload:function(e){let t=e.orgID,n=e.filename;return`${s(t)}/uploads/${n}`},orgExport:function(e){let t=e.orgID,n=e.filename;return`${s(t)}/exports/${n}`},spacePrefix:i,spaceUpload:function(e){let t=e.spaceID,n=e.filename,r=e.kind,o=void 0===r?"square":r;return`${i(t)}/uploads/${o}/${n}`},spaceExport:function(e){let t=e.spaceID,n=e.filename;return`${i(t)}/exports/${n}`}};const d=o()("core:assets");function f(e){const t={metadata:{}};return e.contentType&&(t.metadata={contentType:e.contentType}),e.isImage||(t.metadata.contentDisposition=`attachment; filename="${encodeURIComponent(e.name)}"`),t}var p=class{constructor(e){this.storage=e}async uploadAsset(e,t,n){if(n.isUploaded)return d(`asset ${n.uid} is already uploaded`),n;d(`upload asset in space "${e}" for revision "${t}" "${n.name}"`);const r=await n.asBlob(),o=l.asset({spaceID:e,revisionID:t,assetID:n.uid,fileName:n.name}),a=f(n),s=await this.storage.uploadFile(o,r,a);return n.updateWithMetadata(s)}async uploadAssetBuffer(e,t,n,r){d(`upload asset in space "${e}" for revision "${t}" "${n.name}"`);const o=l.asset({spaceID:e,revisionID:t,assetID:n.uid,fileName:n.name}),a=f(n),s=await this.storage.uploadBuffer(o,r,a);return n.updateWithMetadata(s)}async deleteForSpace(e){const t=l.assets(e);return this.storage.deleteFiles(t)}},h=n(6),m=n(34),b=(n(12),n(4));const g=w(h.h);class y extends(Object(b.Record)({states:Object(b.Map)()})){static deserialize(e){void 0===e&&(e={});const t=new y,n=Object(b.Map)(e.documents||{}).map(e=>w(h.C(e)));return t.merge({states:t.states.merge(n)})}serialize(){return{documents:this.states.map(e=>h.Y(e.document,{normalize:!1})).toJS()}}getEditorValueByURL(e){return e?this.states.get(e,null):g}getEditorValue(e){if(!e.isDocument)throw new Error("Cannot access content of a non document page");return this.getEditorValueByURL(e.documentURL)}getDocument(e){const t=this.getEditorValue(e);return t?t.document:null}getDocumentByURL(e){const t=this.getEditorValueByURL(e);return t?t.document:null}setEditorValueByURL(e,t){return this.merge({states:this.states.set(e,t)})}setDocumentByURL(e,t){return this.setEditorValueByURL(e,w(t))}}function w(e){return h.B(e,{normalize:!1})}var v,O,D,j=y;function E(e,t,n,r,o){var a={};return Object.keys(r).forEach(function(e){a[e]=r[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}const $=o()("backend:documents");var B=(v=Object(m.b)("documents.fetchDocument"),O=Object(m.b)("documents.uploadDocument"),E((D=class{constructor(e){this.storage=e,this.cache=new j,this.pending={},this.listeners=[]}listen(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!=e)}}setCache(e){this.cache=e,this.listeners.forEach(e=>e(this.cache))}serialize(){return this.cache.serialize()}deserialize(e){this.setCache(j.deserialize(e))}cacheDocument(e,t){this.setCache(this.cache.setDocumentByURL(e,t))}async fetchDocument(e,t){e.label("URL",t);const n=this.cache.getDocumentByURL(t);if(n)return n;if(this.pending[t])return this.pending[t];try{this.pending[t]=this.storage.downloadAsJSON(t).then(e=>h.C(e));const e=await this.pending[t];return this.cacheDocument(t,e),e}finally{this.pending[t]=null}}async uploadDocument(e,t,n,r,o,a){$(`upload document in space "${t}" for page "${r}/${o}" in revision "${n}"`,a);const s=h.Y(a),i=l.document({spaceID:t,revisionID:n,versionID:r,pageID:o}),c=(await this.storage.uploadJSON(i,s)).downloadURL;return this.cacheDocument(c,a),c}async deleteForSpace(e){const t=l.documents(e);return this.storage.deleteFiles(t)}}).prototype,"fetchDocument",[v],Object.getOwnPropertyDescriptor(D.prototype,"fetchDocument"),D.prototype),E(D.prototype,"uploadDocument",[O],Object.getOwnPropertyDescriptor(D.prototype,"uploadDocument"),D.prototype),D),S=n(250);n.d(t,"b",function(){return S}),n.d(t,"d",function(){return l}),n.d(t,"c",function(){return B}),n.d(t,"a",function(){return p})},13:function(e,t,n){"use strict";var r=n(576),o=n(62),a=n(415),s=n(104);n(322),n(417),n(418);var i=n(0);var c=i.createContext();var u=function(){return Object(i.useContext)(c)};var l=function(){return u().config},d=n(10),f=n(1),p=n(218);const h="undefined"==typeof window;var m=function(e){const t=i.useContext(c),n=f.Z.useIsLoading(),r=function(e){const t=Object.keys(e).map(t=>e[t]?e[t].cacheKey:null);return t.sort(),t.join("-")}(e),o=t.database.state,a=i.useState({})[1],s=i.useRef();return s.current=i.useMemo(()=>(function(e,t){const n={};return Object.keys(t).forEach(r=>{const o=t[r];o&&(n[r]=function(e,t){const n=e.isFetched(t),r=h?n:e.hasObserver(t);return{query:t,isFetched:n,hasObserver:r,error:e.getError(t),value:t.isDocumentQuery()?e.getDocument(t):e.getCollection(t)}}(e,o))}),n})(o,e),[o,r]),i.useEffect(()=>{const e=e=>{(function(e,t){return Object.keys(t).some(n=>{const r=t[n],o=r.query;return r.isFetched!==e.isFetched(o)||r.hasObserver!==e.hasObserver(o)||(o.isDocumentQuery()?r.value!==e.getDocument(o):!function(e,t){return e===t||!!e&&(!!t&&(e.size===t.size&&e.every((e,n)=>e===t.get(n))))}(r.value,e.getCollection(o)))})})(e,s.current)&&a({})};return e(t.database.state),t.database.listen(e)},[]),Object(p.useAsyncEffect)(()=>{if(n)return{};const e=[],r=[];return Object.keys(s.current).forEach(n=>{const o=s.current[n];if(!o)return;const a=o.query;if(h){if(o.isFetched)return;return void e.push(a instanceof d.l?t.database.getDocument(a):t.database.getCollection(a))}const i=t.database.observe(a),c=i.observerID,u=i.pending;r.push(c),u&&e.push(u)}),{pending:e.length>0?Promise.all(e):null,cleanup:()=>{r.forEach(e=>{t.database.stopObserving(e)})}}},[n,r]),s.current};var b=function(e,t){const n=m(e),r={};let o=!0,a=!1;return Object.keys(n).forEach(e=>{const t=n[e],s=t.query.options,i=s.optimistic,c=s.waitFetched,u=s.background,l=s.placeholder,d=i?t.isFetched:t.isFetched&&t.hasObserver;r[e]=t.value,r[`${e}Fetched`]=d,r[`${e}Error`]=t.error,u||d||!c||(o=!1),u||!l||t.isFetched||a||(a=!0)}),o?i.createElement(f.Z.Provider,{isLoading:a},t(r)):null};const g="undefined"!=typeof window;async function y(e,t){await e.auth.signInWithAuthToken(t,{forceSync:!0}),await e.auth.start()}var w=function(e){void 0===e&&(e=null);const t=i.useContext(c),n=i.useState(t.auth.user),r=n[0],o=n[1];return Object(p.useAsyncEffect)(()=>!e||t.auth.user.live?{}:{pending:y(t,e),cleanup:()=>{g||t.auth.stop()}},[]),i.useEffect(()=>t.auth.listen(e=>{o(e)})),r};var v=function(e,t){const n=w(e);return i.createElement(f.Z.Provider,{isLoading:!!n.isLoggedIn&&!n.live},t(n))};var O=function(){const e=u().documents,t=i.useState(e.cache),n=t[0],r=t[1];return i.useEffect(()=>e.listen(e=>{r(e)}),[]),n};n.d(t,"c",function(){return s.b}),n.d(t,"e",function(){return s.d}),n.d(t,"d",function(){return a.a}),n.d(t,"b",function(){return c}),n.d(t,"i",function(){return l}),n.d(t,"h",function(){return u}),n.d(t,"k",function(){return m}),n.d(t,"m",function(){return b}),n.d(t,"g",function(){return w}),n.d(t,"l",function(){return v}),n.d(t,"j",function(){return O}),n.d(t,"a",function(){return r.a}),n.d(t,"f",function(){return o.a})},22:function(e,t,n){"use strict";var r=async function(e){return new Promise((t,n)=>{e().then(e=>{t(e)},e=>{n(e)})})},o=n(60),a=n.n(o);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=function e(t){if(!a()(t))return t;const n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){s(e,t,n[t])})}return e}({},t);return Object.keys(n).forEach(t=>{a()(n[t])&&(n[t]=e(n[t])),null===n[t]&&delete n[t]}),Object.keys(n).every(e=>null===n[e])?null:n};function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(e,t,n){const r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}({},e);let o=r;const a=t.split("/");let s=0;for(s=0;s<a.length-1;s+=1){const e=a[s];o[e]=o[e]||{},o=o[e]}return o[a[s]]=n,i(r)};n.d(t,"a",function(){return u}),n.d(t,"b",function(){return r})},249:function(e,t,n){"use strict";n(10);var r=n(250);t.a=class{constructor(e){void 0===e&&(e={baseHosts:null,cdnHost:null}),this.options=e}transformURL(e){return this.options.cdnHost?Object(r.transformURL)(e,this.options.cdnHost):e}async getMetadata(e){throw new Error("Method not implemented by GenericBlobStorage interface")}async uploadBuffer(e,t,n){return Promise.reject(new Error("Method not implemented by GenericBlobStorage interface"))}async uploadFile(e,t,n){return Promise.reject(new Error("Method not implemented by GenericBlobStorage interface"))}async uploadJSON(e,t){return Promise.reject(new Error("Method not implemented by GenericBlobStorage interface"))}async downloadAsBuffer(e){return Promise.reject(new Error("Method not implemented by GenericBlobStorage interface"))}async downloadAsString(e){return Promise.reject(new Error("Method not implemented by GenericBlobStorage interface"))}async downloadAsJSON(e){const t=await this.downloadAsString(e);return JSON.parse(t)}async downloadByPath(e){return Promise.reject(new Error("Method not implemented by GenericBlobStorage interface"))}async deleteFiles(e){return Promise.reject(new Error("Method not implemented by GenericBlobStorage interface"))}async deleteFile(e){return Promise.reject(new Error("Method not implemented by GenericBlobStorage interface"))}}},250:function(e,t,n){"use strict";n.r(t),n.d(t,"transformURL",function(){return o});const r=["https://firebasestorage.googleapis.com/v0/b/","https://www.googleapis.com/download/storage/v1/b/"];function o(e,t){return r.reduce((e,n)=>e.replace(n,t),e)}},586:function(e,t,n){"use strict";var r=n(43),o=n.n(r),a=n(10),s=n(22),i=n(249);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const u=o()("core:storage");t.a=class extends i.a{constructor(e,t){super(t),this.storage=e}getRef(e){return this.storage.ref().child(e)}async getMetadata(e){const t=this.getRef(e),n=await Object(s.b)(()=>t.getMetadata()),r=await Object(s.b)(()=>t.getDownloadURL());return a.g.createFromFirebase(n,r)}async uploadToBlobMetadata(e){const t=await Object(s.b)(()=>e.ref.getDownloadURL());return a.g.createFromFirebase(e.metadata,t)}async uploadBuffer(e,t,n){void 0===n&&(n={});const r=this.getRef(e),o=new Blob([t]),a=n.metadata,i=void 0===a?{}:a;u(`upload file "${e}" with metadata`,i);const c=await Object(s.b)(()=>r.put(o,i));return this.uploadToBlobMetadata(c)}async uploadJSON(e,t){const n=this.getRef(e),r={contentType:a.g.MIME_TYPE_JSON};u(`upload JSON "${e}"`,n.toString());const o=await Object(s.b)(()=>n.putString(JSON.stringify(t),"raw",r));return this.uploadToBlobMetadata(o)}async uploadFile(e,t,n){void 0===n&&(n={});const r=this.getRef(e),o=new Blob([t]),a=n,i=a.metadata,l=void 0===i?{}:i,d=a.user;d&&(l.customMetadata=l.customMetadata?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}({},l.customMetadata,{userID:d.uid}):{userID:d.uid}),t.type&&(l.contentType=t.type),u(`upload file "${e}" with metadata`,l);const f=await Object(s.b)(()=>r.put(o,l));return this.uploadToBlobMetadata(f)}async download(e){return fetch(this.transformURL(e))}async downloadAsBuffer(e){return(await this.download(e)).arrayBuffer()}async downloadAsString(e){return(await this.download(e)).text()}async downloadByPath(e){const t=this.getRef(e),n=await t.getDownloadURL();return this.downloadAsBuffer(n)}}},595:function(e,t,n){"use strict";var r=class{async publish(e,t){throw new Error("Not implemented")}};t.a=class extends r{}},62:function(e,t,n){"use strict";var r=n(662);n(890),n(891),n(892);t.a=r}}]);