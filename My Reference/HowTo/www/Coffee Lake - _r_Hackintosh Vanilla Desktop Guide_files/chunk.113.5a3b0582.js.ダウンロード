(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[113,167],{109:function(t,e,r){"use strict";var i=r(4),s=r(24),n=r(22);function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}let o=0;class c extends(Object(i.Record)({isFetched:!1,observers:Object(i.Map)(),unlisten:()=>{},query:new s.h,error:null})){get count(){return this.observers.size}get status(){return this.isFetched?this.count>0?"READY":"STALE":"PENDING"}}class h extends(Object(i.Record)({queries:Object(i.Map)(),collections:Object(i.Map)(),observers:Object(i.Map)()})){static genObserverID(){return`${o+=1}`}static deserialize(t){void 0===t&&(t={});const e=Object(i.Map)((t.queries||[]).map(t=>{let e=t.query,r=t.isFetched;const i=new c({query:s.j.deserialize(e),isFetched:r});return[i.query.cacheKey,i]})),r=Object(i.Map)(t.collections||{}).map(t=>Object(i.OrderedMap)(t.map(t=>{let e=t.key,r=t.kind,i=t.value;return[e,i?Object(s.O)(r,i):null]})));return new h({queries:e,collections:r})}serialize(){const t=this.collections.map(t=>t.toArray().map(t=>{let e=t[0],r=t[1];return r?{key:e,kind:r.kind,value:r.serialize()}:{key:e,value:null}})).toJS();return{queries:this.queries.toArray().map(t=>{t[0];let e=t[1],r=e.query,i=e.isFetched;return{query:r.serialize(),isFetched:i}}),collections:t}}hasObserver(t){const e=this.queries.get(t.cacheKey);return Boolean(e&&e.count>0)}addObserver(t,e,r){void 0===r&&(r=null);const i=this.queries.get(t.cacheKey,new c({query:t})),s=i.merge({observers:i.observers.set(e,r)});return this.merge({observers:this.observers.set(e,t),queries:this.queries.set(t.cacheKey,s)})}setUnlistener(t,e){const r=this.queries.get(t.cacheKey,new c({query:t}));r.unlisten();const i=r.merge({unlisten:e});return this.merge({queries:this.queries.set(t.cacheKey,i)})}removeObserver(t){const e=this.observers.get(t);if(!e)return this;const r=this.queries.get(e.cacheKey);if(!r||!r.observers.has(t))return this;let i=r.merge({observers:r.observers.delete(t)});return 0==i.count&&(i.unlisten(),i=i.merge({unlisten:()=>{}})),this.merge({observers:this.observers.delete(t),queries:this.queries.set(e.cacheKey,i)})}isFetched(t){const e=this.queries.get(t.cacheKey);return Boolean(e&&e.isFetched)}emitDocumentChange(t){const e=this.queries.get(t.cacheKey);if(!e)return;const r=this.getDocument(t);e.observers.forEach(t=>{t&&t(r)})}emitCollectionChanges(t,e,r){e.forEach((e,i)=>{r.has(i)||this.emitDocumentChange(t.doc(i))}),r.forEach((r,s)=>{const n=e.get(s);n&&Object(i.is)(n,r)||this.emitDocumentChange(t.doc(s))})}markAsFetched(t){const e=this.queries.get(t.cacheKey,new c({query:t})).merge({isFetched:!0});return this.merge({queries:this.queries.set(t.cacheKey,e)})}setError(t,e){const r=this.queries.get(t.cacheKey,new c({query:t})).merge({error:e});return this.merge({queries:this.queries.set(t.cacheKey,r)})}getError(t){const e=this.queries.get(t.cacheKey);return e?e.error:null}getDocument(t){const e=this.getCollection(t.parent()),r=this.isFetched(t),i=e.get(t.documentKey,null);return r||i?i:t.defaultValue}getCollection(t){const e=this.collections.get(t.collectionKeys.join("/"),Object(i.OrderedMap)()),r=t.filters.isEmpty()?e:e.filter(e=>t.matchDocument(e));return!this.isFetched(t)&&r.isEmpty()?t.defaultValue:null!==t.limit?r.slice(-t.limit):r}setCollection(t,e){const r=this.collections,s=r.get(t.path,Object(i.OrderedMap)()),n=(t.hasLimit()?s:s.filter(e=>!t.matchDocument(e))).merge(e).sortBy((t,e)=>e);return this.merge({collections:r.set(t.path,n)})}setDocument(t,e){const r=t.parent(),i=this.getCollection(r).set(t.documentKey,e);return this.setCollection(r,i)}updateDocument(t,e){const r=this.getDocument(t);if(!r)throw new Error("no previous document");const i=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),i.forEach(function(e){a(t,e,r[e])})}return t}({},r.serialize(),e),n=Object(s.O)(r.kind,i);return this.setDocument(t,n)}updateDocumentProperty(t,e,r){const i=this.getDocument(t);if(!i)throw new Error("no previous document");const a=i.serialize(),o=Object(n.a)(a,e,r);if(null===o)return this.deleteDocument(t);const c=Object(s.O)(i.kind,o);return this.setDocument(t,c)}deleteDocument(t){const e=t.parent(),r=this.getCollection(e).delete(t.documentKey);return this.setCollection(e,r)}deleteCollection(t){return this.setCollection(t,Object(i.OrderedMap)())}populate(t){return t.reduce((t,e)=>{let r=e[0],i=e[1];return t.setDocument(r,i)},this)}commit(t){return t.operations.reduce((t,e)=>"set"==e.type&&e.doc?t.setDocument(e.query,e.doc):"update"==e.type&&e.properties?t.updateDocument(e.query,e.properties):"update_property"===e.type?t.updateDocumentProperty(e.query,e.property,e.value):"delete"==e.type?t.deleteDocument(e.query):"delete_collection"==e.type?t.deleteCollection(e.query):t,this)}debug(){this.queries.toList().sortBy(t=>-t.count).forEach(t=>{let e=t.status,r=t.count,i=t.query;console.log(`* [${e}] (${i.isDocumentQuery()?"document":"collection"}) ${i.path} (${r})`)})}toRTDBData(){return this.collections.reduce((t,e,r)=>e.reduce((t,e,i)=>t.push([`${r}/${i}`,e.serialize()]),t),Object(i.List)()).sortBy(t=>{return t[0].length}).reduce((t,e)=>{let r=e[0],i=e[1];return t.setIn(r.split("/"),i)},Object(i.Map)()).toJS()}}e.a=h},251:function(t,e,r){"use strict";(function(t,i){var s=r(24),n=r(109);e.a=class{constructor(t,e){void 0===t&&(t=(()=>{})),void 0===e&&(e=new n.a),this.listeners=[t],this.state=e}serialize(){return this.state.serialize()}deserialize(t){this.state=n.a.deserialize(t),this.onStateChanged(this.state)}listen(t){return this.listeners.push(t),()=>{this.listeners=this.listeners.filter(e=>e!=t)}}onStateChanged(t){this.listeners.forEach(e=>e(t))}updateState(e,r){void 0===r&&(r=!1);const s=this.state;this.state=e(this.state),s!=this.state&&(this.immediateID&&t(this.immediateID),r?this.onStateChanged(this.state):this.immediateID=i(()=>{this.immediateID=null,this.onStateChanged(this.state)}))}setOnline(t){throw new Error("not implemented")}observeDocument(t,e){throw new Error("not implemented")}observeCollection(t){throw new Error("not implemented")}observe(t){return t instanceof s.j?this.observeDocument(t):this.observeCollection(t)}stopObserving(t){this.updateState(e=>e.removeObserver(t),!0)}async getDocument(t){throw new Error("not implemented")}async getCollection(t){throw new Error("not implemented")}async setDocument(t,e){throw new Error("not implemented")}async updateDocument(t,e){throw new Error("not implemented")}async updateProperty(t,e,r){throw new Error("not implemented")}async deleteDocument(t){throw new Error("not implemented")}async commit(t){throw new Error("not implemented")}async transaction(t,e){throw new Error("not implemented")}}}).call(this,r(223).clearImmediate,r(223).setImmediate)},252:function(t,e,r){"use strict";var i=r(10);e.a=class{constructor(t,e){let r=void 0===e?{}:e,s=r.onUser,n=r.initialUser;var a,o,c;c=!1,(o="blockedUpdate")in(a=this)?Object.defineProperty(a,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[o]=c,this.analytics=t,this.user=n||i.d.createVisitor(),this.listeners=[s||(()=>{})]}serialize(){return this.user.serialize()}deserialize(t){this.user=i.d.deserialize(t),this.onUser(this.user)}onUser(t){this.listeners.forEach(e=>e(t))}listen(t){return this.listeners.push(t),()=>{this.listeners=this.listeners.filter(e=>e!=t)}}async waitBeforeDispatch(t){if(this.blockedUpdate)return t();const e=this.user;this.blockedUpdate=!0;try{return await t()}finally{this.blockedUpdate=!1,this.user!=e&&this.onUser(this.user)}}dispatchUser(t){const e=t(this.user);this.user.isVisitor&&!e.isVisitor&&e.isInitialSession&&this.analytics.alias(e),this.analytics.identify(e),this.user=e,this.blockedUpdate||this.onUser(this.user)}stop(){throw new Error("not implemented")}async start(){throw new Error("not implemented")}getCurrentUser(){return this.user}async signUp(t,e,r){throw new Error("not implemented")}async signIn(t,e){throw new Error("not implemented")}async verifyEmail(t){throw new Error("not implemented")}async uploadPhoto(t,e){throw new Error("not implemented")}async createProfile(t){throw new Error("not implemented")}async updateProfile(t,e){throw new Error("not implemented")}async updateEmail(t){throw new Error("not implemented")}async updatePassword(t){throw new Error("not implemented")}async signInWithAuthToken(t,e){throw void 0===e&&(e={forceSync:!1}),new Error("not implemented")}async signInWithGoogle(){throw new Error("not implemented")}async signInWithGitHub(){throw new Error("not implemented")}async reauthenticate(t,e){throw new Error("not implemented")}async reauthenticateWithGoogle(){throw new Error("not implemented")}async reauthenticateWithGithub(t){throw(void 0===t?{}:t).scopes,new Error("not implemented")}async resetPassword(t){throw new Error("not implemented")}async verifyPasswordResetCode(t){throw new Error("not implemented")}async confirmPasswordReset(t,e){throw new Error("not implemented")}async checkActionCode(t){throw new Error("not implemented")}async applyActionCode(t,e){throw new Error("not implemented")}async linkWithGoogle(){throw new Error("not implemented")}async linkWithGithub(){throw new Error("not implemented")}async unlinkGoogle(){throw new Error("not implemented")}async unlinkGithub(){throw new Error("not implemented")}async verifyIdToken(t){throw new Error("not implemented")}async createAuthToken(t,e){throw void 0===e&&(e={}),new Error("not implemented")}async getUser(t){throw new Error("not implemented")}async getUserByEmail(t){throw new Error("not implemented")}async importUsers(t){throw new Error("not implemented")}async setCustomClaims(t,e){throw new Error("not implemented")}async createSessionCookie(t,e){throw new Error("not implemented")}async verifySessionCookie(t){throw new Error("not implemented")}async verifyPhoneNumber(t,e){throw new Error("not implemented")}async reauthenticateWithPhone(t,e,r){throw new Error("not implemented")}async unlinkPhone(){throw new Error("not implemented")}async deleteAccount(){throw new Error("not implemented")}async signOut(){throw new Error("not implemented")}}},253:function(t,e,r){"use strict";function i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),i.forEach(function(e){s(t,e,r[e])})}return t}function s(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function n(t){return{"Space Visibility":t.visibility,"Space Is Indexable":t.isIndexable,"Space Has Shareable Link":!!t.secretToken,"Space Has GitHub":t.hasGitHubSync,"Space Has Custom Domain":Boolean(t.customDomain)}}function a(t){return{"Is Owner User":!1,"Org Type":t.type||"business","Org Has Custom Domain":Boolean(t.customDomain),"Org Has SSO":Boolean(t.ssoSignInLabel)}}function o(t){return t.isOrg?a(t):{"Is Owner User":!0}}function c(t){return{"Pages Conflicting":t.getConflictingPagesCount(),"During Publish":t.isPublish}}function h(t){const e=t.compare();return{Changes:e.addedPages+e.modifiedPages+e.removedPages,"Versions Created":e.addedVersions,"Versions Deleted":e.removedVersions,"Versions Modified":e.modifiedVersions,"Pages Created":e.addedPages,"Pages Deleted":e.removedPages,"Pages Modified":e.modifiedPages}}function u(t){return{Characters:t.length,Lines:(t.match(/\n|$/g)||[]).length,Emojis:(t.match(/(?:\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDEFF])/g)||[]).length}}e.a=class{identify(t){}alias(t){}group(t){}page(){}track(t){}trackOrgEvent(t,e){}trackSignIn(t){return void 0===t&&(t="password"),this.track({type:"Sign-in",Provider:t})}trackSignUp(t){return void 0===t&&(t="password"),this.track({type:"Sign-up",Provider:t})}trackVerifyPhone(t){return this.track({type:"Verify Phone",Country:t})}trackVerifyEmail(){return this.track({type:"Verify Email"})}trackCreateOrg(t,e){const r=i({type:"Create Organization"},a(t),n(e));this.track(r),this.trackOrgEvent(t,r)}trackDeleteOrg(t){const e=i({type:"Delete Organization"},a(t));this.track(e),this.trackOrgEvent(t,e)}trackSetupCustomDomain(t,e){let r=i({type:"Setup Custom Domain"},o(t));e&&(r=i({},r,n(e))),this.track(r),t.isOrg&&this.trackOrgEvent(t,r)}trackStartMigration(t){const e=i({type:"Start Migration"},o(t));this.track(e),t.isOrg&&this.trackOrgEvent(t,e)}trackConfirmMigration(t){const e=i({type:"Confirm Migration"},o(t));this.track(e),t.isOrg&&this.trackOrgEvent(t,e)}trackRollbackMigration(t){const e=i({type:"Rollback Migration"},o(t));this.track(e),t.isOrg&&this.trackOrgEvent(t,e)}trackCreateSpace(t,e){const r=i({type:"Create Space"},o(t),n(e));this.track(r),t.isOrg&&this.trackOrgEvent(t,r)}trackJoinOrg(t){let e=t.org;const r=i({type:"Join Organization",Role:t.role,"Is Team":t.isTeam},a(e));this.track(r),this.trackOrgEvent(e,r)}trackCreateTeam(t){const e=i({type:"Create Team"},a(t));this.track(e),this.trackOrgEvent(t,e)}trackStartEditing(t,e){const r=i({type:"Start Editing"},o(t),n(e));this.track(r),t.isOrg&&this.trackOrgEvent(t,r)}trackSaveDraft(t){let e=t.owner,r=t.space,s=t.draft,a=t.workingState;const c=i({type:"Save Draft","Is First Save":s.isInitial},o(e),n(r),h(a));this.track(c),e.isOrg&&this.trackOrgEvent(e,c)}trackResumeEditing(t){let e=t.owner,r=t.space,s=t.workingState;const a=i({type:"Resume Editing"},o(e),n(r),h(s));this.track(a),e.isOrg&&this.trackOrgEvent(e,a)}trackCancelEdits(t){let e=t.owner,r=t.space,s=t.workingState;const a=i({type:"Cancel Edits"},o(e),n(r),h(s));this.track(a),e.isOrg&&this.trackOrgEvent(e,a)}trackPostComment(t){let e=t.owner,r=t.space,s=t.body,a=t.onDraft;const c=i({type:"Post Comment","On Content":t.onContent,"On Draft":a},u(s),o(e),n(r));this.track(c),e.isOrg&&this.trackOrgEvent(e,c)}trackPostReply(t){let e=t.owner,r=t.space,s=t.body,a=t.onDraft;const c=i({type:"Post Reply","On Activity":t.onActivity,"On Draft":a},u(s),o(e),n(r));this.track(c),e.isOrg&&this.trackOrgEvent(e,c)}trackPublishDraft(t){let e=t.owner,r=t.space,s=t.workingState;const a=i({type:"Publish Draft"},o(e),n(r),h(s));this.track(a),e.isOrg&&this.trackOrgEvent(e,a)}trackConflictStart(t){let e=t.owner,r=t.space,s=t.conflictsState;const a=i({type:"Conflict Start"},o(e),n(r),c(s));this.track(a),e.isOrg&&this.trackOrgEvent(e,a)}trackConflictResolution(t){let e=t.owner,r=t.space,s=t.conflictsState;const a=i({type:"Conflict Resolution"},o(e),n(r),c(s),{"Time Spent":s.getResolutionDuration()/1e3});this.track(a),e.isOrg&&this.trackOrgEvent(e,a)}trackConflictAbortion(t){let e=t.owner,r=t.space,s=t.conflictsState;const a=i({type:"Conflict Abortion"},o(e),n(r),c(s),{"Time Spent":s.getResolutionDuration()/1e3});this.track(a),e.isOrg&&this.trackOrgEvent(e,a)}trackRatePage(t,e,r){const s=i({type:"Rate Page",Rating:r},o(t),n(e));this.track(s),t.isOrg&&this.trackOrgEvent(t,s)}trackCloseDraft(t,e){const r=i({type:"Close Draft"},o(t),n(e));this.track(r),t.isOrg&&this.trackOrgEvent(t,r)}trackReopenDraft(t,e){const r=i({type:"Reopen Draft"},o(t),n(e));this.track(r),t.isOrg&&this.trackOrgEvent(t,r)}trackRollback(t,e,r){const s=i({type:"Rollback Revision","Is Draft":r},o(t),n(e));this.track(s),t.isOrg&&this.trackOrgEvent(t,s)}trackTransferSpace(t,e,r){const s=i({type:"Transfer Space","To Kind":e.kind},o(t),n(r));this.track(s),t.isOrg&&this.trackOrgEvent(t,s)}trackUpgrade(t,e,r){const s=i({type:"Upgrade",Plan:r,"Previous Plan":e},a(t));this.track(s),this.trackOrgEvent(t,s)}trackDowngrade(t,e,r){const s=i({type:"Downgrade",Plan:r,"Previous Plan":e},a(t));this.track(s),this.trackOrgEvent(t,s)}trackExportUser(t){const e={type:"Export User",userID:t};this.track(e)}trackExportOrg(t){const e=i({type:"Export Org"},a(t));this.track(e),this.trackOrgEvent(t,e)}trackExportSpace(t,e){const r=i({type:"Export Space"},o(t),n(e));this.track(r),t.isOrg&&this.trackOrgEvent(t,r)}trackSetSpaceVisibility(t,e){const r=i({type:"Set Space Visibility"},o(t),n(e));this.track(r),t.isOrg&&this.trackOrgEvent(t,r)}trackToggleSpaceUnlisted(t,e,r){const s=i({type:"Toggle Space Unlisted"},o(t),n(e),{Enabled:r});this.track(s),t.isOrg&&this.trackOrgEvent(t,s)}trackToggleShareableLink(t,e,r){const s=i({type:"Toggle Space Shareable Link"},o(t),n(e),{Enabled:r});this.track(s),t.isOrg&&this.trackOrgEvent(t,s)}trackToggleFullLogo(t,e,r){const s=i({type:"Toggle Full Logo"},o(t),n(e),{Enabled:r});this.track(s),t.isOrg&&this.trackOrgEvent(t,s)}trackSetupGitHubSync(t,e,r){let s=r.githubConfig,a=r.editOnGitHub;const c=i({type:"Setup GitHub Sync",Priority:s.priority,"Only Master":s.importBranchesFilter.equals(["master"]),"Has Edit On GitHub":a},o(t),n(e));this.track(c),t.isOrg&&this.trackOrgEvent(t,c)}}},322:function(t,e,r){"use strict";r(251),r(109)},415:function(t,e,r){"use strict";var i=r(43),s=r.n(i),n=r(588),a=r.n(n),o=r(4),c=r(10);function h(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const u=s()("core:search");class l{constructor(t,e){this.spaceID=e.uid,this.client=a()(t,e.algoliaAPIKey)}static createForSpace(t,e){return new l(t,e)}getAnalyticsTags(t){return[`space/${this.spaceID}`,`version/${t}`]}fetchResults(t,e,r){void 0===r&&(r={});const i=this.client.initIndex(t.INDEX);return u(`search "${e}" on ${t.INDEX}`),i.search(e,function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),i.forEach(function(e){h(t,e,r[e])})}return t}({},r,{getRankingInfo:!0})).then(e=>{let r=e.hits;return Object(o.List)(r).map(e=>t.deserialize(e))})}fetchUsers(t){return this.fetchResults(c.O,t)}fetchPages(t){let e=t.versionID,r=t.query;return this.fetchResults(c.z,r,{filters:c.z.getVersionFilter(e),analyticsTags:this.getAnalyticsTags(e)})}fetchSections(t){let e=t.versionID,r=t.query;return this.fetchResults(c.E,r,{filters:c.E.getVersionFilter(e),analyticsTags:this.getAnalyticsTags(e)})}}e.a=l},417:function(t,e,r){"use strict";r(252)},418:function(t,e,r){"use strict";r(253)},576:function(t,e,r){"use strict";var i=r(62),s=r(586),n=r(104),a=r(4),o=r(92),c=r(43),h=r.n(c),u=r(24),l=r(34),d=r(22);function p(t){return t.message.startsWith("PERMISSION_DENIED")}function y(t){const e=t.map(t=>t.kind);return e.sort(),e}function g(t){return["database",`db-kinds:${y(t).join(",")}`]}function b(t,e){return p(e)?(o.configureScope(e=>{e.setFingerprint(g([t]))}),new Error(`DB Permission Denied for "${t.kind}"`)):e}var m,w,f,O,v,k,D,P,E,S=r(109),j=r(251);function C(t,e,r,i,s){var n={};return Object.keys(i).forEach(function(t){n[t]=i[t]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=r.slice().reverse().reduce(function(r,i){return i(t,e,r)||r},n),s&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(t,e,n),n=null),n}const I=h()("backend:database");var U,A,T,R,q,z,F=(m=Object(l.b)("database.getDocument"),w=Object(l.b)("database.getCollection"),f=Object(l.b)("database.setDocument"),O=Object(l.b)("database.updateDocument"),v=Object(l.b)("database.updateProperty"),k=Object(l.b)("database.deleteDocument"),D=Object(l.b)("database.commit"),P=Object(l.b)("database.transaction"),C((E=class extends j.a{constructor(t,e,r){void 0===e&&(e=(()=>{})),void 0===r&&(r=new S.a),super(e,r),this.db=t}setOnline(t){I(`set database as ${t?"online":"offline"}`),t?this.db.goOnline():this.db.goOffline()}onDocumentUpdated(t,e){const r=e.exists()?Object(u.O)(t.kind,e.val()):null;return this.updateState(e=>{const i=e.markAsFetched(t);return null==r?i.deleteDocument(t):i.setDocument(t,r)},!0),this.state.emitDocumentChange(t),r}onDocumentError(t,e){t.options.ignoreErrors||o.captureException(e),this.updateState(r=>r.markAsFetched(t).deleteDocument(t).setError(t,e),!0),this.state.emitDocumentChange(t)}onCollectionUpdated(t,e){let r=Object(a.OrderedMap)();e.forEach(e=>{const i=Object(u.O)(t.kind,e.val());r=r.set(e.key,i)});const i=this.state.getCollection(t);this.updateState(e=>e.markAsFetched(t).setCollection(t,r),!0);const s=this.state.getCollection(t);return this.state.emitCollectionChanges(t,i,s),s}onCollectionError(t,e){o.captureException(e);const r=this.state.getCollection(t);this.updateState(r=>r.markAsFetched(t).deleteCollection(t).setError(t,e),!0);const i=this.state.getCollection(t);this.state.emitCollectionChanges(t,r,i)}getCollectionRef(t){let e=this.db.ref(t.path);const r=t.filters.first();if(r)switch(e=e.orderByChild(r.property),r.sign){case">=":e=e.startAt(r.value);break;case"<=":e=e.endAt(r.value);break;case"==":e=e.equalTo(r.value);break;default:throw new Error(`Invalid sign "${r.sign}"`)}return null!==t.limit&&(e=e.limitToLast(t.limit)),e}getDocumentRef(t){return this.db.ref(t.path)}observeDocument(t,e){const r=S.a.genObserverID(),i=this.state.hasObserver(t);if(this.updateState(i=>i.addObserver(t,r,e)),i)return{observerID:r,pending:null};const s=new l.a("database.observeDocument");s.label("Path",t.path),s.label("Kind",t.kind),I(`observe changes in document "${t.path}"`);const n=new Promise((e,r)=>{let i=!1;const n=()=>{i||(i=!0,s.end(),e())},a=this.getDocumentRef(t),o=a.on("value",e=>{this.onDocumentUpdated(t,e),n()},e=>{I("error: ",e),this.onDocumentError(t,e),n()}),c=()=>{a.off("value",o)};this.updateState(e=>e.setUnlistener(t,c))});return{observerID:r,pending:n}}observeCollection(t){const e=this.getCollectionRef(t),r=S.a.genObserverID(),i=this.state.hasObserver(t);if(this.updateState(e=>e.addObserver(t,r)),i)return{observerID:r,pending:null};const s=new l.a("database.observeCollection");s.label("Path",t.path),s.label("Kind",t.kind),I(`observe changes in collection ${t.path}`);const n=new Promise((r,i)=>{let n=!1;const a=()=>{n||(n=!0,s.end(),r())},o=e.on("value",e=>{this.onCollectionUpdated(t,e),a()},e=>{I("error: ",e),this.onCollectionError(t,e),a()}),c=()=>{e.off("value",o)};this.updateState(e=>e.setUnlistener(t,c))});return{observerID:r,pending:n}}async getDocument(t,e){t.label("Path",e.path),t.label("Kind",e.kind);const r=this.getDocumentRef(e),i=await Object(d.b)(()=>r.once("value"));return this.onDocumentUpdated(e,i)}async getCollection(t,e){t.label("Path",e.path),t.label("Kind",e.kind);const r=this.getCollectionRef(e),i=await Object(d.b)(()=>r.once("value"));return this.onCollectionUpdated(e,i)}async setDocument(t,e,r){t.label("Kind",e.kind),t.label("Path",e.path);const i=r.serialize(),s=this.getDocumentRef(e);I("set document",e.path,i);try{await Object(d.b)(()=>s.set(i))}catch(n){throw t.label("Value",i),b(e,n)}}async updateDocument(t,e,r){t.label("Kind",e.kind),t.label("Path",e.path);const i=this.getDocumentRef(e);I("update document",e.path,r);try{await Object(d.b)(()=>i.update(r))}catch(s){throw t.label("Properties",r),b(e,s)}}async updateProperty(t,e,r,i){t.label("Kind",e.kind),t.label("Path",e.path),t.label("Property",r),I("update document property",`${e.path}/${r}`,i);try{await Object(d.b)(()=>this.db.ref(e.path).update({[r]:i}))}catch(s){throw t.label("Value",i),b(e,s)}}async deleteDocument(t,e){t.label("Kind",e.kind),t.label("Path",e.path);const r=this.getDocumentRef(e);I("delete document",e.path);try{await Object(d.b)(()=>r.remove())}catch(i){throw b(e,i)}}async commit(t,e){const r=e.toPathMap();I("commit update",r);try{await Object(d.b)(()=>this.db.ref().update(r))}catch(i){throw t.label("Update",r),function(t,e){if(!p(e))return e;const r=t.operations.map(t=>t.query),i=y(r);return o.configureScope(t=>{t.setFingerprint(g(r))}),new Error(`DB Permission Denied while updating ${i.join(", ")}`)}(e,i)}}async retryTransaction(t,e,r){void 0===r&&(r=0);try{await Object(d.b)(()=>t.transaction(t=>e(t)))}catch(i){if("maxretry"!==i.message)throw i;if(r>4)throw new Error("Transaction failed after 4 retries");await async function(t){return new Promise(e=>setTimeout(e,t))}(500+Math.ceil(1e3*Math.random())),await this.retryTransaction(t,e,r+1)}}async transaction(t,e,r,i){void 0===i&&(i=0),t.label("Kind",e.kind),t.label("Path",e.path);try{await this.retryTransaction(this.getDocumentRef(e),t=>{const i=t?Object(u.O)(e.kind,t):null,s=r(i);if(void 0!==s)return s?s.serialize():null})}catch(s){throw b(e,s)}}}).prototype,"getDocument",[m],Object.getOwnPropertyDescriptor(E.prototype,"getDocument"),E.prototype),C(E.prototype,"getCollection",[w],Object.getOwnPropertyDescriptor(E.prototype,"getCollection"),E.prototype),C(E.prototype,"setDocument",[f],Object.getOwnPropertyDescriptor(E.prototype,"setDocument"),E.prototype),C(E.prototype,"updateDocument",[O],Object.getOwnPropertyDescriptor(E.prototype,"updateDocument"),E.prototype),C(E.prototype,"updateProperty",[v],Object.getOwnPropertyDescriptor(E.prototype,"updateProperty"),E.prototype),C(E.prototype,"deleteDocument",[k],Object.getOwnPropertyDescriptor(E.prototype,"deleteDocument"),E.prototype),C(E.prototype,"commit",[D],Object.getOwnPropertyDescriptor(E.prototype,"commit"),E.prototype),C(E.prototype,"transaction",[P],Object.getOwnPropertyDescriptor(E.prototype,"transaction"),E.prototype),E),W=r(220),L=r.n(W),$=r(653),V=r(131),B=r.n(V),K=r(293),G=r.n(K),M=r(31),x=r.n(M),_=r(380),H=r(10),N=r(252);function J(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Q(t,e,r,i,s){var n={};return Object.keys(i).forEach(function(t){n[t]=i[t]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=r.slice().reverse().reduce(function(r,i){return i(t,e,r)||r},n),s&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(t,e,n),n=null),n}const X=h()("backend:auth");function Y(t){return t.response?t.response.errors?t.response.errors[0]:new Error(t.response.error):t}var Z=(U=Object(l.b)("auth.start"),A=Object(l.b)("auth.signUp"),T=Object(l.b)("auth.signIn"),R=Object(l.b)("auth.signInAsLegacy"),q=Object(l.b)("auth.signInWithAuthToken"),Q((z=class t extends N.a{static resetVisitor(){const t=L.a.v4();B.a.set("visitor_uid",t)}static createVisitor(){const t=B.a.get("visitor_uid")||L.a.v4();return B.a.set("visitor_uid",t),H.d.createVisitor({uid:t})}constructor(t,e,r,s,n){super(s,n),this.auth=t,this.storage=e,this.database=r,this.apiEndpoint=n.apiEndpoint,this.auth.setPersistence(i.a.auth.Auth.Persistence.NONE)}stop(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.stopObserveProfile(),this.stopObserveIdToken()}assertUser(){const t=this.auth.currentUser;if(!t||t.uid===H.d.VISITOR_UID)throw new Error("User is not logged in");return t}dispatchVisitor(){this.stopObserveProfile(),this.stopObserveIdToken(),this.dispatchUser(()=>t.createVisitor())}async dispatchFirebaseUser(t,e){if(void 0===e&&(e={}),t.uid===H.d.VISITOR_UID)return void this.dispatchVisitor();const r=!this.user.live||this.user.uid!=t.uid,i=H.d.createFromFirebase(function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),i.forEach(function(e){J(t,e,r[e])})}return t}({},t,{customClaims:e}));await this.waitBeforeDispatch(async()=>{this.dispatchUser(t=>r?i:t.mergeWithAuthUser(i)),await Promise.all([r?this.observeProfile(t):null,r?this.observeIdToken(t):this.onIdTokenChanged(t)])})}async onIdTokenChanged(t){try{const r=await Object(d.b)(()=>t.getIdToken());this.dispatchUser(t=>t.setIdToken(r))}catch(e){if("auth/app-deleted"===e.code||"auth/user-disabled"===e.code||"auth/user-token-expired"===e.code)return void(await this.signOut());throw e}}async observeProfile(t){this.stopObserveProfile();const e=this.database.observeDocument(H.L.queryByID(t.uid),t=>{if(t){const e=t;this.dispatchUser(t=>t.mergeWithUser(e))}}),r=e.observerID,i=e.pending;this.userObserver=r,await i}stopObserveProfile(){this.userObserver&&(this.database.stopObserving(this.userObserver),this.userObserver=null)}async observeIdToken(t){this.stopObserveIdToken(),this.unsubscribeToken=this.auth.onIdTokenChanged(()=>{this.onIdTokenChanged(t)}),await this.onIdTokenChanged(t)}stopObserveIdToken(){this.unsubscribeToken&&(this.unsubscribeToken(),this.unsubscribeToken=null)}async start(t){x()(!this.unsubscribe,"Authentication backend already has a listener"),this.unsubscribe||await new Promise((t,e)=>{this.unsubscribe=this.auth.onAuthStateChanged(async r=>{if(X(`auth state changed to ${r?"logged in":"visitor"}`),!r)return this.dispatchVisitor(),void t();try{await this.dispatchFirebaseUser(r)}catch(i){return void e(i)}t()})})}async signUp(t,e,r,i){X("sign up new user"),await this.waitBeforeDispatch(async()=>{const t=(await Object(d.b)(()=>this.auth.createUserWithEmailAndPassword(r,i))).user;await Object(d.b)(()=>t.updateProfile({displayName:e}));try{if(await this.checkWithLegacy(t,i))return}catch(n){throw await this.signOut(),await Object(d.b)(()=>t.delete()),n}await this.dispatchFirebaseUser(t);const s=this.user.updateDisplayName(e);await this.createProfile(s),this.analytics.identify(s),this.analytics.trackSignUp()})}async signIn(t,e,r){X("sign in user"),await this.waitBeforeDispatch(async()=>{try{const i=(await Object(d.b)(()=>this.auth.signInWithEmailAndPassword(e,r))).user;await this.dispatchFirebaseUser(i)}catch(t){if("auth/user-not-found"!==t.code||!(await this.signInAsLegacy(e,r)))throw t}this.analytics.identify(this.user),this.analytics.trackSignIn()})}async signInAsLegacy(t,e,r){const i=new _.GraphQLClient(this.apiEndpoint);try{const t=(await i.request("\n    mutation LegacySignIn($email: String!, $password: String!) {\n      legacySignIn(email: $email, password: $password) {\n        auth {\n            uid,\n            token\n        }\n      }\n    }\n",{email:e,password:r})).legacySignIn.auth;return!!t&&(await this.signInWithAuthToken(t),!0)}catch(s){throw Y(s)}}async signInWithAuthToken(t,e,r){void 0===r&&(r={forceSync:!1});const i=e.token,s=r.forceSync,n=async()=>{await this.signOut(),this.database.setOnline(!0)};if(!i)return X("sign out user"),void(await n());X("sign in user using a custom token"),await this.waitBeforeDispatch(async()=>{try{const e=(await Object(d.b)(()=>this.auth.signInWithCustomToken(i))).user;this.database.setOnline(!0);const r=(i?G()(i):{}).claims;await this.dispatchFirebaseUser(e,r),this.analytics.trackSignIn()}catch(t){if(X("error login with token: ",t),!s)throw t;await n()}})}async reauthenticate(t,e){const r=this.auth.currentUser,s=i.a.auth.EmailAuthProvider.credential(t,e);return Object(d.b)(()=>r.reauthenticateWithCredential(s))}async reauthenticateWithGoogle(){const t=new i.a.auth.GoogleAuthProvider;return this.reauthenticateWithProvider(t)}async reauthenticateWithGithub(t){let e=(void 0===t?{}:t).scopes,r=void 0===e?[]:e;const s=new i.a.auth.GithubAuthProvider;return r.forEach(t=>s.addScope(t)),this.reauthenticateWithProvider(s)}async reauthenticateWithProvider(t){const e=this.assertUser();return null!=e.providerData.find(e=>e.providerId==t.providerId)?Object(d.b)(()=>e.reauthenticateWithPopup(t)):Object(d.b)(()=>e.linkWithPopup(t))}async verifyEmail(t){const e=this.assertUser(),r=t?{url:t}:void 0;await Object(d.b)(()=>e.sendEmailVerification(r))}async uploadPhoto(t,e){const r=n.d.userUpload({userID:t.uid,filename:e.name}),i=await this.storage.uploadFile(r,e,{metadata:{contentType:e.type},user:t});await this.updateProfile(t.merge({photoURL:i.downloadURL}))}async createProfile(t){const e=t.baseDomain||H.L.normalizeBaseDomain(t.email.split("@")[0]),r=t.toUser().setBaseDomain(e),i=this.assertUser();await Object(d.b)(()=>i.updateProfile({displayName:t.displayName,photoURL:t.photoURL}));try{await this.database.commit(r.toCreateUpdate())}catch(s){await this.database.commit(t.toUser().toCreateUpdate())}}async updateProfile(t,e){void 0===e&&(e=!1);const r=this.assertUser();await this.waitBeforeDispatch(async()=>{try{await this.flushProfile(t,e),await Object(d.b)(()=>r.updateProfile({displayName:t.displayName,photoURL:t.photoURL}))}catch(i){throw await this.flushProfile(this.user),i}})}async updateEmail(t){const e=this.assertUser();await this.waitBeforeDispatch(async()=>{await Object(d.b)(()=>e.updateEmail(t)),await this.dispatchFirebaseUser(this.auth.currentUser)})}async updatePassword(t){const e=this.assertUser();await Object(d.b)(()=>e.updatePassword(t))}async signOut(){t.resetVisitor(),await this.waitBeforeDispatch(async()=>{await Object(d.b)(()=>this.auth.signOut()),this.dispatchUser(()=>t.createVisitor())})}async checkWithLegacy(t,e){if(H.d.isLegacyID(t.uid))return!1;const r=await Object(d.b)(()=>t.getIdToken(!0)),i=new _.GraphQLClient(this.apiEndpoint,{headers:{Authorization:H.d.getAuthorizationHeader(t.uid,r)}});let s;try{s=(await i.request("\n    mutation LegacyCheck($password: String) {\n      legacyCheckUser(password: $password) {\n          auth {\n            uid,\n            token\n        }\n      }\n    }\n",{password:e})).legacyCheckUser.auth}catch(n){throw Y(n)}return!!s&&(await this.signInWithAuthToken(s),!0)}async signInWithProvider(t){await this.waitBeforeDispatch(async()=>{const e=(await Object(d.b)(()=>this.auth.signInWithPopup(t))).user,r=this.auth.currentUser,i=r.metadata.creationTime===r.metadata.lastSignInTime;try{if(await this.checkWithLegacy(e))return}catch(s){throw i&&await Object(d.b)(()=>r.delete()),await this.signOut(),s}await this.dispatchFirebaseUser(e),this.analytics.identify(this.user),i?(this.analytics.trackSignUp(t.providerId),await this.createProfile(this.user)):this.analytics.trackSignIn(t.providerId)})}async signInWithGoogle(){const t=new i.a.auth.GoogleAuthProvider;await this.signInWithProvider(t)}async signInWithGitHub(){const t=new i.a.auth.GithubAuthProvider;await this.signInWithProvider(t)}async flushProfile(t,e){void 0===e&&(e=!1);const r=t.toUser();e?await this.database.commit(r.toProfileUpdate()):await this.database.setDocument(r.query(),r)}async resetPassword(t){await Object(d.b)(()=>this.auth.sendPasswordResetEmail(t))}async verifyPasswordResetCode(t){await Object(d.b)(()=>this.auth.verifyPasswordResetCode(t))}async confirmPasswordReset(t,e){await Object(d.b)(()=>this.auth.confirmPasswordReset(t,e))}async checkActionCode(t){await Object(d.b)(()=>this.auth.checkActionCode(t))}async applyActionCode(t,e){await Object(d.b)(()=>this.auth.applyActionCode(e));const r=this.assertUser();await Object(d.b)(()=>r.reload()),await Object(d.b)(()=>r.getIdToken(!0)),await this.dispatchFirebaseUser(r),"verifyEmail"==t&&this.analytics.trackVerifyEmail()}async linkWithGoogle(){const t=new i.a.auth.GoogleAuthProvider;await this.linkWithProvider(t)}async linkWithGithub(){const t=new i.a.auth.GithubAuthProvider;await this.linkWithProvider(t)}async linkWithProvider(t){const e=this.assertUser();await this.waitBeforeDispatch(async()=>{await Object(d.b)(()=>e.linkWithPopup(t)),await this.dispatchFirebaseUser(e)})}async unlinkProvider(t){const e=this.assertUser();await this.waitBeforeDispatch(async()=>{await Object(d.b)(()=>e.unlink(t)),await this.dispatchFirebaseUser(e)})}async unlinkGoogle(){await this.unlinkProvider("google.com")}async unlinkGithub(){await this.unlinkProvider("github.com")}async verifyPhoneNumber(t,e){const r=new i.a.auth.PhoneAuthProvider;return this.waitBeforeDispatch(async()=>Object(d.b)(()=>r.verifyPhoneNumber(t,e)))}async reauthenticateWithPhone(t,e,r){const s=this.assertUser(),n=i.a.auth.PhoneAuthProvider.credential(r,e),a=Object($.c)(t).country;await this.waitBeforeDispatch(async()=>{await Object(d.b)(()=>s.linkAndRetrieveDataWithCredential(n)),this.analytics.trackVerifyPhone(a),await this.dispatchFirebaseUser(s)})}async unlinkPhone(){await this.unlinkProvider("phone")}async deleteAccount(){const t=this.assertUser();await t.delete()}}).prototype,"start",[U],Object.getOwnPropertyDescriptor(z.prototype,"start"),z.prototype),Q(z.prototype,"signUp",[A],Object.getOwnPropertyDescriptor(z.prototype,"signUp"),z.prototype),Q(z.prototype,"signIn",[T],Object.getOwnPropertyDescriptor(z.prototype,"signIn"),z.prototype),Q(z.prototype,"signInAsLegacy",[R],Object.getOwnPropertyDescriptor(z.prototype,"signInAsLegacy"),z.prototype),Q(z.prototype,"signInWithAuthToken",[q],Object.getOwnPropertyDescriptor(z.prototype,"signInWithAuthToken"),z.prototype),z),tt=r(595),et=r(57),rt=r.n(et),it=r(89),st=r(679),nt=r(253);function at(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),i.forEach(function(e){ot(t,e,r[e])})}return t}function ot(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const ct=h()("core:analytics");var ht=class extends nt.a{constructor(t){if(super(),ot(this,"hotjarId",null),ot(this,"hasSetupHotjar",!1),this.hotjarId=t.hotjar.site_id,t.sentry.url){const e=r.p.startsWith("http://localhost");it.init({debug:e,dsn:t.sentry.url,release:t.version,environment:"browser",integrations:t=>t.map(t=>"Breadcrumbs"===t.name?new it.Integrations.Breadcrumbs({console:!1}):t),ignoreErrors:["Failed to fetch","Network Error"],whitelistUrls:e?[r.p,"webpack-internal://"]:[r.p]})}this.superProperties={Version:t.version},t.mixpanel.token&&rt.a.init(t.mixpanel.token,{},"users"),t.mixpanel.orgs_token&&rt.a.init(t.mixpanel.orgs_token,{},"orgs")}identify(t){if(!t.isLoggedIn)return void this.resetToAnonymous(t);const e={$name:t.displayName,$email:t.email,$phone:t.phoneNumber,$created:t.createdAt.toISOString(),id:t.uid,"Testing Variant":t.variant,"Has Phone Verified":t.hasPhoneVerified,"Risk Score":t.riskScore,"Sign-in Providers":t.providers.keySeq().toArray()};t.usageStatuses&&(e["Usage Status Private Spaces"]=t.usageStatuses.privateSpaces,e["Usage Status Public Spaces"]=t.usageStatuses.publicSpaces),ct(`identify user ${t.uid}:`,e),rt.a.users&&(rt.a.users.identify(t.uid),rt.a.users.people.set(e)),it.configureScope(e=>{e.setUser({id:t.uid,email:t.email,username:t.baseDomain})}),!this.hasSetupHotjar&&this.hotjarId&&(st.hotjar.initialize(this.hotjarId,6),this.hasSetupHotjar=!0)}resetToAnonymous(t){ct(`reset to anonymous visitor ${t.uid}:`),rt.a.users&&(rt.a.users.reset(),rt.a.users.identify(t.uid))}alias(t){ct(`alias current session to ${t.uid}`),rt.a.users&&rt.a.users.alias(t.uid)}group(t){const e={$name:t.name,$created:t.createdAt,Type:t.type||"business","Base Domain":t.baseDomain,"Custom Domain":t.customDomain,"SSO Label":t.ssoSignInLabel};t.usageStatuses&&(e["Usage Status Private Spaces"]=t.usageStatuses.privateSpaces,e["Usage Status Public Spaces"]=t.usageStatuses.publicSpaces,e["Usage Status Members"]=t.usageStatuses.members),ct(`group current user with ${t.uid}`,e),rt.a.orgs&&(rt.a.orgs.identify(t.uid),rt.a.orgs.people.set(e))}page(){ct("track page view",window.location.pathname)}track(t){const e=at({},t,this.superProperties);delete e.type,ct(`track event ${t.type} with`,e),rt.a.users&&rt.a.users.track(t.type,e),window.hj&&window.hj("tagRecording",[t.type])}trackOrgEvent(t,e){const r=at({distinct_id:t.uid},e,this.superProperties);delete r.type,ct(`track event ${e.type} for org ${t.uid} with`,r),rt.a.orgs&&rt.a.orgs.track(e.type,r)}};var ut=class{serialize(){return{database:this.database.serialize(),documents:this.documents.serialize(),user:this.auth.serialize()}}deserialize(t){this.documents.deserialize(t.documents||{}),this.database.deserialize(t.database||{}),this.auth.deserialize(t.user||{})}async destroy(){return Promise.resolve()}};e.a=class extends ut{constructor(t,e){void 0===e&&(e={}),super(),this.isClient=!0,this.config=t,this.app=i.a.initializeApp(t.firebase),this.database=new F(this.app.database(),e.onDatabaseState,e.initialDatabaseState),this.storage=new s.a(this.app.storage(),{cdnHost:t.cdn.blobsurl}),this.analytics=new ht(t),this.auth=new Z(this.app.auth(),this.storage,this.database,this.analytics,{apiEndpoint:t.urls.api,initialUser:e.initialUser,onUser:e.onUser}),this.documents=new n.c(this.storage),this.assets=new n.a(this.storage),this.pubsub=new tt.a}async destroy(){await this.app.delete()}}}}]);