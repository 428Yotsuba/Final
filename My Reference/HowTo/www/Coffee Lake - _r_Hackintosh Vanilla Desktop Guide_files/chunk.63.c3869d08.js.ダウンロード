(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[63],{1129:function(e,t,o){"use strict";o.r(t);var n=o(0),r=o(26),l=o(3),c=o(1),s=o(39),a=o(25),i=o(185),m=o(838),b=o(9);const d=c.nb.S,u=c.ob.S100,E=l.StyleSheet.create({commentsButtonPositioner:{position:"absolute",zIndex:2,left:"100%",top:-c.ob.S100/2,marginLeft:c.ob.S200,[`@media ${s.e}`]:{top:c.ob.S100,marginLeft:(c.ob.S300-u)/2}},commentsButton:{display:"flex",alignItems:"center",justifyContent:"center",width:d,height:d,borderRadius:d,borderBottomLeftRadius:0,border:`1px solid ${c.kb.GREY_LIGHT}`,color:c.kb.GREY_BASE,cursor:"pointer",userSelect:"none",":hover":{background:c.kb.GREY_LIGHTER},[`@media ${s.e}`]:{borderColor:c.kb.BLUE_BASE,background:c.kb.BLUE_BASE,color:c.kb.BLUE_BASE,width:u,height:u,borderRadius:u,borderBottomLeftRadius:0}},commentsButtonActive:{borderColor:c.kb.BLUE_BASE,background:c.kb.BLUE_BASE,color:c.kb.WHITE,":hover":{borderColor:c.kb.BLUE_BASE,background:c.kb.BLUE_BASE,color:c.kb.WHITE}},commentsButtonIcon:{transition:c.qb.fastEaseOut("transform"),transform:"rotate(0deg)"},commentsButtonIconActive:{transform:"rotate(45deg)"},commentsButtonContent:{[`@media ${s.e}`]:{display:"none"}}});var p=n.forwardRef(function(e,t){const o=e.active,r=e.count,l=e.onMouseEnter,s=e.onMouseLeave,a=e.onClick;return n.createElement(c.gb,{styles:[E.commentsButtonPositioner]},n.createElement(c.gb,{ref:t,styles:[E.commentsButton,!o&&c.pb.tooltipped,!o&&c.pb.left,o&&E.commentsButtonActive],"aria-label":"Leave a comment",contentEditable:!1,onMouseEnter:l,onMouseLeave:s,onClick:a},o||0===r?n.createElement(c.gb,{styles:[E.commentsButtonIcon,E.commentsButtonContent,o&&E.commentsButtonIconActive]},n.createElement(b.Pb,{size:"medium"})):n.createElement(c.eb.UIH200,{styles:[E.commentsButtonContent]},r)))}),f=o(2048),y=o(2008),g=o(1996),v=o(2009);var k=function(e){const t=e.block,o=e.draftID,r=e.versionID,l=e.pageID,c=Object(v.a)().postContentComment,s=n.useRef();return n.useEffect(()=>{s.current&&s.current.focus()}),n.createElement(g.b,{ref:s,onPost:e=>{c({block:t,draftID:o,versionID:r,pageID:l,body:e})}})},S=(o(10),o(2023));function I(e){const t=e.comment,o=e.withReplies,r=e.onClick;return n.createElement(g.c,{createdAt:t.createdAt,createdBy:t.actorID,body:t.payload.body,onClick:r},o&&t.replies.total>0&&n.createElement(S.c,{activity:t}))}I.defaultProps={withReplies:!0};var h=I,B=o(825);var C=function(e){const t=e.comments,o=e.scrollableRef,r=Object(B.a)().openActivity;return n.useEffect(()=>{const e=o.current;e&&(e.scrollTop=e.scrollHeight)},[t.size]),n.createElement(n.Fragment,null,t.valueSeq().map(e=>n.createElement(h,{key:e.uid,comment:e,onClick:()=>r(e)})))};const D=l.StyleSheet.create({commentsPopover:{flex:1,display:"flex",flexDirection:"column"},commentsPopoverHeader:{display:"flex",flex:"0 0 auto",flexDirection:"row",alignItems:"center",borderBottom:`1px solid ${c.kb.GREY_LIGHTER}`,padding:c.ob.S100},commentsPopoverHeaderMobileOnly:{display:"none",[`@media ${s.e}`]:{display:"flex"}},commentsPopoverHeaderText:{flex:1,paddingLeft:c.ob.S100,paddingRight:c.ob.S100,color:c.kb.GREY_DARK},commentsPopoverHeaderIcon:{alignSelf:"flex-end",padding:c.ob.S100,cursor:"pointer",":hover":{color:c.kb.BLUE_BASE}},commentsPopoverBody:{flex:1,borderBottom:`1px solid ${c.kb.GREY_LIGHTER}`},commentsMobilePlaceholder:{display:"none",[`@media ${s.e}`]:{display:"block"}},commentsPopoverFooter:{flex:"0 0 auto"}});function L(e){const t=e.title,o=e.icon,r=e.mobileOnly,l=e.onClick;return n.createElement(c.gb,{styles:[D.commentsPopoverHeader]},n.createElement(c.gb,{styles:[D.commentsPopoverHeaderText]},n.createElement(c.gb,{styles:[r&&D.commentsPopoverHeaderMobileOnly]},n.createElement(c.eb.InfoH200,{styles:[c.eb.COLOR.greyDark]},t)),n.createElement(c.gb,null,n.createElement(b.lc,{size:"small",styles:[c.eb.COLOR.greyBase]})," ",n.createElement(c.eb.InfoH100,{styles:[c.eb.COLOR.greyBase]},"Visible only to writers"))),n.createElement(c.gb,{styles:[D.commentsPopoverHeaderIcon,r&&D.commentsPopoverHeaderMobileOnly],onClick:l},o))}var P=function(e){const t=e.block,o=e.draftID,r=e.versionID,l=e.pageID,s=e.activityID,a=e.comments,i=e.onClose,m=e.onCloseThread,d=n.useRef(),u=a.find(e=>e.uid===s);return u?n.createElement(c.gb,{styles:[D.commentsPopover]},n.createElement(L,{title:"Thread",mobileOnly:!1,icon:n.createElement(b.k,null),onClick:m}),n.createElement(c.X,{ref:d,styles:[D.commentsPopoverBody,c.X.STYLES.withScrollbarOnHover]},n.createElement(h,{comment:u,withReplies:!1}),u.replies.total>0&&n.createElement(f.b,{count:u.replies.total}),n.createElement(f.c,{scrollableRef:d,activityID:u.uid})),n.createElement(c.gb,{styles:[D.commentsPopoverFooter]},n.createElement(f.d,{activity:u}))):n.createElement(c.gb,{styles:[D.commentsPopover]},n.createElement(L,{title:"Comments",mobileOnly:!0,icon:n.createElement(b.mc,null),onClick:i}),a.size>0?n.createElement(c.X,{ref:d,styles:[D.commentsPopoverBody,c.X.STYLES.withScrollbarOnHover]},n.createElement(C,{comments:a,scrollableRef:d})):n.createElement(c.gb,{styles:[D.commentsPopoverBody,D.commentsMobilePlaceholder]},n.createElement(y.a,null)),n.createElement(c.gb,{styles:[D.commentsPopoverFooter]},n.createElement(k,{block:t,draftID:o,versionID:r,pageID:l})))};const A=l.StyleSheet.create({commentsArea:{position:"relative"},commentsAreaHighlight:{position:"absolute",top:-c.ob.S300/2,bottom:-c.ob.S300/2,background:"transparent",transition:"background 300ms ease",left:-c.ob.S200,right:-c.ob.S200,[`@media ${c.G.MOBILE}`]:{left:-c.ob.S300,right:-c.ob.S300},[`@media ${c.G.TABLET_LANDSCAPE}`]:{left:-c.ob.S900,right:-c.ob.S900}},commentsAreaHighlightOn:{background:c.kb.GREY_LIGHTEST},contentWrapper:{position:"relative"},mobilePopover:{display:"flex",position:"fixed",bottom:0,left:0,right:0,height:"280px",zIndex:c.rb.SIDESHEET,background:c.kb.WHITE,borderTop:`1px solid ${c.kb.GREY_LIGHTER}`},desktopPopover:{display:"flex",width:270,maxHeight:312}});var H=function(e){const t=e.block,o=e.children,l=Object(B.a)(),b=l.openNodeComments,d=l.closeContentComments,u=Object(a.l)().contentContext,E=n.useRef(),f=n.useState(!1),y=f[0],g=f[1],v=n.useState(!1),k=v[0],S=v[1],I=Object(r.e)(i.a)[0],h=c.J.useMediaQuery(s.e),C=n.useContext(m.a),D=C.comments,L=C.draftID,H=C.versionID,R=C.pageID,O=D.filter(e=>e.payload.nodeID===t.key),_=c.J.useMediaQuery(I.state.opened?s.l:s.k),x=u.commentAnchor===t.key,T=k||x,w=y||x||O.size>0,M=()=>{b(t.key)},G=()=>{d()},U=()=>{x?G():M()};n.useEffect(()=>{x&&E.current&&!h&&E.current.scrollIntoView({block:"center",behavior:"smooth"})},[x]);const $=w?n.createElement(P,{block:t,draftID:L,versionID:H,pageID:R,activityID:u.activityID,comments:O,onClose:G,onCloseThread:()=>{M()}}):null;return n.createElement(c.gb,{ref:E,styles:[A.commentsArea],onMouseEnter:()=>g(!0),onMouseLeave:()=>{g(!1),S(!1)}},n.createElement(c.gb,{contentEditable:!1,styles:[A.commentsAreaHighlight,T&&A.commentsAreaHighlightOn],onMouseDown:e=>{e.preventDefault()}}),n.createElement(c.gb,{onClick:e=>{h&&!e.defaultPrevented&&(e.stopPropagation(),U())},styles:[A.contentWrapper]},o),w&&n.createElement(c.N.Closeable,{opened:x,closeOnOutsideClick:!h,closeOnScroll:!1,fixed:!1,onClose:G,anchor:e=>{let t=e.ref;return n.createElement(p,{ref:t,active:x,count:O.size,onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),onClick:U})}},h?n.createElement(c.gb,{styles:[A.mobilePopover]},$):n.createElement(c.T,{align:_?"end":"start",autoPosition:!0},n.createElement(c.gb,{styles:[A.desktopPopover]},$))))};t.default=H}}]);