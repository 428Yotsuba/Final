Push.Notification.Thread=Push.Notification.extend({_lastPostTime:0,_pageNo:0,_defaultMessage:"de.wbb-elite.push++.notification.thread",init:function(d,a,c,b){this._objectID=d;this._lastPostTime=c;this._pageNo=a;this._super($.extend(true,{type:"thread"},b||{}));new Push.Notification.Thread.Update(d,a,b)},_success:function(e){if(e.returnValues.template===undefined||e.returnValues.nextPageNotice===undefined||!e.returnValues.lastPostTime||e.returnValues.templatePageLinks===undefined){return}this._lastPostTime=e.returnValues.lastPostTime?e.returnValues.lastPostTime:this._lastPostTime;var c=$("body#tpl_wbb_thread div.section > .wbbThreadPostList");var b=$("body#tpl_wbb_thread .messageListPagination");var a=elById("messageQuickReply");$(".wbbMorePostsNotice").remove();var d=$(e.returnValues.template);d.each(function(g,h){var f=elData(elBySel("article",this),"post-id");if(elById("post"+f)){delete d[g]}});if(d.find("li").length>0){this._showMessage();if(a){if(b.length){d.insertBefore(b)}else{d.insertBefore(a)}}else{if(b.length){d.insertBefore(b)}else{c.append(d)}}this._showNotification(elById(elAttr(d[0],"id")))}if(e.returnValues.nextPageNotice){if(a){$('<li class="wbbMorePostsNotice"><p class="info">'+e.returnValues.nextPageNotice+"</p></li>").insertBefore(a)}else{c.append($('<li class="wbbMorePostsNotice"><p class="info">'+e.returnValues.nextPageNotice+"</p></li>"))}}if(a){elData(a,"last-post-time",e.returnValues.lastPostTime)}if(b.length>0){$(b.find(".pagination")).html($(e.returnValues.templatePageLinks).html());WCF.System.PageNavigation.init(".pagination")}},_reload:function(){var a=elById("messageQuickReply");if(a){this._lastPostTime=this._lastPostTime>parseInt(elData(a,"last-post-time"))?this._lastPostTime:parseInt(elData(a,"last-post-time"))}this._proxy.setOption("data",{actionName:"getNewPosts",className:"wbb\\data\\thread\\ThreadPushAction",objectIDs:[this._objectID],parameters:{countPosts:false,lastPostTime:this._lastPostTime,pageNo:this._pageNo}});this._proxy.sendRequest()}});Push.Notification.Thread.Update=Push.Notification.extend({pageNo:0,_messageIDs:[],_defaultMessage:"de.wbb-elite.push++.notification.thread.update",init:function(c,a,b){this._objectID=c;this._pageNo=a;this._super($.extend(true,{type:"postUpdate"},b||{}))},_success:function(c){var b=this;var a=c.returnValues.postID;require(["WoltLabSuite/Core/Dom/Util","Dom/Traverse","EventHandler","WoltLabSuite/Forum/Controller/Thread"],(function(k,f,r,q){var o=q.getPostInlineEditor();var g=elBySel("article.wbbPost",elById("post"+a));var l=o._elements.get(g);var h=elBySelAll(".attachmentThumbnailList, .attachmentFileList",l.messageFooter);k.setInnerHtml(f.childByClass(l.messageBody,"messageText"),c.returnValues.message);if(typeof c.returnValues.attachmentList==="string"){for(var n=0,e=h.length;n<e;n++){elRemove(h[n])}var m=elCreate("div");k.setInnerHtml(m,c.returnValues.attachmentList);var j;while(m.childNodes.length){j=m.childNodes[m.childNodes.length-1];l.messageFooter.insertBefore(j,l.messageFooter.firstChild)}}if(typeof c.returnValues.poll==="string"){var p=elBySel(".pollContainer",l.messageBody);if(p!==null){elRemove(p.parentNode)}var d=elCreate("div");d.className="jsInlineEditorHideContent";k.setInnerHtml(d,c.returnValues.poll);k.prepend(d,l.messageBody)}o._updateHistory(o._getHash(a));b._showMessage()}).bind(this))},_reload:function(){this._proxy.setOption("data",{actionName:"reloadPostMessage",className:"wbb\\data\\thread\\ThreadPushAction",parameters:{pageNo:this._pageNo,index:parseInt(elBySel("ul.messageQuickOptions > li > a",elById("post"+this._data.data.messageID)).innerHTML.replace("#","")),postID:this._data.data.postID},objectIDs:[this._objectID]});this._proxy.sendRequest()}});